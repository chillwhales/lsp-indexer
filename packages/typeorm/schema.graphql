enum LSP4TokenTypeEnum {
  TOKEN
  NFT
  COLLECTION
}

enum LSP8TokenIdFormatEnum {
  NUMBER
  STRING
  ADDRESS
  BYTES32
}

enum OperationType {
  CALL
  CREATE
  CREATE2
  STATICCALL
  DELEGATECALL
}

type Executed @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  decodedOperationType: OperationType! @index
  operationType: BigInt! @index
  value: BigInt! @index
  target: String! @index
  selector: String! @index
  universalProfile: UniversalProfile @index
}

type UniversalReceiver @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  from: String! @index
  value: BigInt! @index
  typeId: String! @index
  receivedData: String!
  returnedValue: String!
  universalProfile: UniversalProfile! @index
}

type Follow @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  followerAddress: String! @index
  followedAddress: String! @index
  followerUniversalProfile: UniversalProfile! @index
  followedUniversalProfile: UniversalProfile! @index
}

type Follower @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  followerAddress: String! @index
  followedAddress: String! @index
  followerUniversalProfile: UniversalProfile! @index
  followedUniversalProfile: UniversalProfile! @index
}

type Unfollow @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  followerAddress: String! @index
  unfollowedAddress: String! @index
  followerUniversalProfile: UniversalProfile! @index
  unfollowedUniversalProfile: UniversalProfile! @index
}

type DataChanged @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  dataKey: String! @index
  dataValue: String!
  universalProfile: UniversalProfile @index
  digitalAsset: DigitalAsset @index
}

type TokenIdDataChanged @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  tokenId: String! @index
  address: String! @index
  dataKey: String! @index
  dataValue: String!
  digitalAsset: DigitalAsset! @index
  nft: NFT! @index
}

type Transfer @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  operator: String! @index
  from: String! @index
  to: String! @index
  amount: BigInt! @index
  tokenId: String @index
  force: Boolean! @index
  data: String!
  digitalAsset: DigitalAsset! @index
  nft: NFT @index
}

type DeployedContracts @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  primaryContract: String!
  secondaryContract: String!
  primaryContractDeployment: PrimaryContractDeployment!
  secondaryContractDeployment: SecondaryContractDeployment!
  postDeploymentModule: String! @index
  postDeploymentModuleCalldata: String!
}

type DeployedERC1167Proxies @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  primaryContract: String!
  secondaryContract: String!
  primaryContractDeploymentInit: PrimaryContractDeploymentInit!
  secondaryContractDeploymentInit: SecondaryContractDeploymentInit!
  postDeploymentModule: String! @index
  postDeploymentModuleCalldata: String!
}

type OwnershipTransferred @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  previousOwner: String! @index
  newOwner: String! @index
  universalProfile: UniversalProfile @index
  digitalAsset: DigitalAsset @index
}

type PrimaryContractDeployment {
  salt: String!
  fundingAmount: BigInt!
  creationBytecode: String!
}

type SecondaryContractDeployment {
  fundingAmount: BigInt!
  creationBytecode: String!
  addPrimaryContractAddress: Boolean!
  extraConstructorParams: String!
}

type PrimaryContractDeploymentInit {
  salt: String!
  fundingAmount: BigInt!
  implementationContract: String!
  initializationCalldata: String!
}

type SecondaryContractDeploymentInit {
  fundingAmount: BigInt!
  implementationContract: String!
  initializationCalldata: String!
  addPrimaryContractAddress: Boolean!
  extraInitializationParams: String!
}

type UniversalProfile @entity {
  id: ID! @unique
  address: String! @index
  owner: UniversalProfileOwner @derivedFrom(field: "universalProfile")
  ownedAssets: [OwnedAsset!]! @derivedFrom(field: "universalProfile")
  ownedTokens: [OwnedToken!]! @derivedFrom(field: "universalProfile")

  # ERC725 Data Keys
  lsp3Profile: LSP3Profile @index
  lsp5ReceivedAssetsLength: LSP5ReceivedAssetsLength @derivedFrom(field: "universalProfile")
  lsp5ReceivedAssets: [LSP5ReceivedAsset!]! @derivedFrom(field: "universalProfile")
  lsp6ControllersLength: LSP6ControllersLength @derivedFrom(field: "universalProfile")
  lsp6Controllers: [LSP6Controller!]! @derivedFrom(field: "universalProfile")
  lsp12IssuedAssetsLength: LSP12IssuedAssetsLength @derivedFrom(field: "universalProfile")
  lsp12IssuedAssets: [LSP12IssuedAsset!]! @derivedFrom(field: "universalProfile")
  lsp4CreatorOf: [LSP4Creator!]! @derivedFrom(field: "creatorProfile")
  lsp6ControllerOf: [LSP6Controller!]! @derivedFrom(field: "controllerProfile")

  # LSP29 Encrypted Assets
  lsp29EncryptedAssetsLength: LSP29EncryptedAssetsLength @derivedFrom(field: "universalProfile")
  lsp29EncryptedAssetEntries: [LSP29EncryptedAssetEntry!]! @derivedFrom(field: "universalProfile")
  lsp29EncryptedAssetRevisionCount: [LSP29EncryptedAssetRevisionCount!]!
    @derivedFrom(field: "universalProfile")
  lsp29EncryptedAssets: [LSP29EncryptedAsset!]! @derivedFrom(field: "universalProfile")

  # Events
  executed: [Executed!]! @derivedFrom(field: "universalProfile")
  dataChanged: [DataChanged!]! @derivedFrom(field: "universalProfile")
  ownershipTransferred: [OwnershipTransferred!]! @derivedFrom(field: "universalProfile")
  universalReceiver: [UniversalReceiver!]! @derivedFrom(field: "universalProfile")
  followed: [Follow!]! @derivedFrom(field: "followerUniversalProfile")
  followedBy: [Follow!]! @derivedFrom(field: "followedUniversalProfile")
  unfollowed: [Unfollow!]! @derivedFrom(field: "followerUniversalProfile")
  unfollowedBy: [Unfollow!]! @derivedFrom(field: "unfollowedUniversalProfile")

  # Marketplace
  listingsAsSeller: [Listing!]! @derivedFrom(field: "sellerUniversalProfile")
  listingCreatedAsSeller: [ListingCreated!]! @derivedFrom(field: "sellerUniversalProfile")
  purchasesAsBuyer: [PurchaseCompleted!]! @derivedFrom(field: "buyerUniversalProfile")
  purchasesAsSeller: [PurchaseCompleted!]! @derivedFrom(field: "sellerUniversalProfile")
  tokensWithdrawnAsRecipient: [TokensWithdrawn!]! @derivedFrom(field: "recipientUniversalProfile")
  platformProceedsWithdrawnAsRecipient: [PlatformProceedsWithdrawn!]!
    @derivedFrom(field: "recipientUniversalProfile")
  sellerProceedsWithdrawnAsSeller: [SellerProceedsWithdrawn!]!
    @derivedFrom(field: "sellerUniversalProfile")
  sellerProceedsWithdrawnAsRecipient: [SellerProceedsWithdrawn!]!
    @derivedFrom(field: "recipientUniversalProfile")
}

type DigitalAsset @entity {
  id: ID! @unique
  address: String! @index
  owner: DigitalAssetOwner @derivedFrom(field: "digitalAsset")
  totalSupply: TotalSupply @derivedFrom(field: "digitalAsset")
  ownedAssets: [OwnedAsset!]! @derivedFrom(field: "digitalAsset")
  ownedTokens: [OwnedToken!]! @derivedFrom(field: "digitalAsset")

  # ERC725 Data Keys
  lsp4Metadata: LSP4Metadata @index
  lsp4TokenName: LSP4TokenName @derivedFrom(field: "digitalAsset")
  lsp4TokenSymbol: LSP4TokenSymbol @derivedFrom(field: "digitalAsset")
  lsp4TokenType: LSP4TokenType @derivedFrom(field: "digitalAsset")
  lsp4CreatorsLength: LSP4CreatorsLength @derivedFrom(field: "digitalAsset")
  lsp4Creators: [LSP4Creator!]! @derivedFrom(field: "digitalAsset")
  lsp5ReceivedBy: [LSP5ReceivedAsset!]! @derivedFrom(field: "receivedAsset")
  lsp12IssuedBy: [LSP12IssuedAsset!]! @derivedFrom(field: "issuedAsset")

  # LSP7 properties
  decimals: Decimals @derivedFrom(field: "digitalAsset")

  # LSP8 properties
  lsp8TokenIdFormat: LSP8TokenIdFormat @derivedFrom(field: "digitalAsset")
  lsp8ReferenceContract: LSP8ReferenceContract @derivedFrom(field: "digitalAsset")
  lsp8TokenMetadataBaseUri: LSP8TokenMetadataBaseURI @derivedFrom(field: "digitalAsset")
  nfts: [NFT!]! @derivedFrom(field: "digitalAsset")

  # Events
  dataChanged: [DataChanged!]! @derivedFrom(field: "digitalAsset")
  tokenIdDataChanged: [TokenIdDataChanged!]! @derivedFrom(field: "digitalAsset")
  transfer: [Transfer!]! @derivedFrom(field: "digitalAsset")
  ownershipTransferred: [OwnershipTransferred!]! @derivedFrom(field: "digitalAsset")

  # Marketplace
  listingsAsToken: [Listing!]! @derivedFrom(field: "tokenDigitalAsset")
  listingCreatedAsToken: [ListingCreated!]! @derivedFrom(field: "tokenDigitalAsset")
  purchasesAsToken: [PurchaseCompleted!]! @derivedFrom(field: "tokenDigitalAsset")
  purchasesAsPaymentToken: [PurchaseCompleted!]! @derivedFrom(field: "paymentTokenDigitalAsset")
  platformProceedsWithdrawnAsPaymentToken: [PlatformProceedsWithdrawn!]!
    @derivedFrom(field: "paymentTokenDigitalAsset")
  sellerProceedsWithdrawnAsPaymentToken: [SellerProceedsWithdrawn!]!
    @derivedFrom(field: "paymentTokenDigitalAsset")
}

type TotalSupply @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  digitalAsset: DigitalAsset! @index @unique
  value: BigInt! @index
}

type Decimals @entity {
  id: ID! @unique
  address: String! @index
  digitalAsset: DigitalAsset! @index @unique
  value: Int! @index
}

type UniversalProfileOwner @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  universalProfile: UniversalProfile! @index @unique
}

type DigitalAssetOwner @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  digitalAsset: DigitalAsset! @index @unique
}

type NFT @entity @index(fields: ["tokenId", "digitalAsset"]) {
  id: ID! @unique
  tokenId: String! @index
  formattedTokenId: String @index
  address: String! @index
  digitalAsset: DigitalAsset @index
  lsp4Metadata: LSP4Metadata @index
  lsp4MetadataBaseUri: LSP4Metadata @index
  isMinted: Boolean! @index
  isBurned: Boolean! @index
  ownedToken: OwnedToken @derivedFrom(field: "nft")

  # chillwhales properties
  chillClaimed: ChillClaimed @derivedFrom(field: "nft")
  orbsClaimed: OrbsClaimed @derivedFrom(field: "nft")

  # ORBS properties
  level: OrbLevel @derivedFrom(field: "nft")
  cooldownExpiry: OrbCooldownExpiry @derivedFrom(field: "nft")
  faction: OrbFaction @derivedFrom(field: "nft")

  # Events
  tokenIdDataChanged: [TokenIdDataChanged!]! @derivedFrom(field: "nft")
  transfer: [Transfer!]! @derivedFrom(field: "nft")
}

type OwnedAsset @entity @index(fields: ["address", "owner"]) {
  id: ID! @unique
  block: Int! @index
  timestamp: DateTime! @index
  balance: BigInt! @index
  address: String! @index
  owner: String! @index

  digitalAsset: DigitalAsset @index
  universalProfile: UniversalProfile @index

  # LSP8 properties
  tokenIds: [OwnedToken!] @derivedFrom(field: "ownedAsset")
}

type OwnedToken @entity @index(fields: ["address", "tokenId", "owner"]) {
  id: ID! @unique
  block: Int! @index
  timestamp: DateTime! @index
  tokenId: String! @index
  address: String! @index
  owner: String! @index

  nft: NFT @index @unique
  digitalAsset: DigitalAsset @index
  universalProfile: UniversalProfile @index

  ownedAsset: OwnedAsset @index
}

type LSP4TokenName @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  digitalAsset: DigitalAsset! @index @unique
  value: String @index
  rawValue: String!
}

type LSP4TokenSymbol @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  digitalAsset: DigitalAsset! @index @unique
  value: String @index
  rawValue: String!
}

type LSP4TokenType @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  digitalAsset: DigitalAsset! @index @unique
  value: LSP4TokenTypeEnum @index
  rawValue: String!
}

type LSP4CreatorsLength @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  digitalAsset: DigitalAsset! @index @unique
  value: BigInt @index
  rawValue: String!
}

type LSP4Creator @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  digitalAsset: DigitalAsset! @index
  creatorAddress: String! @index
  creatorProfile: UniversalProfile @index
  arrayIndex: BigInt @index
  interfaceId: String @index
}

type LSP5ReceivedAssetsLength @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  universalProfile: UniversalProfile! @index @unique
  value: BigInt @index
  rawValue: String!
}

type LSP5ReceivedAsset @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  universalProfile: UniversalProfile! @index
  assetAddress: String! @index
  receivedAsset: DigitalAsset @index
  arrayIndex: BigInt @index
  interfaceId: String @index
}

type LSP6ControllersLength @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  universalProfile: UniversalProfile! @index @unique
  value: BigInt @index
  rawValue: String!
}

type LSP6Controller @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  universalProfile: UniversalProfile! @index
  controllerAddress: String! @index
  controllerProfile: UniversalProfile @index
  arrayIndex: BigInt @index
  permissions: [LSP6Permission!]! @derivedFrom(field: "controller")
  permissionsRawValue: String
  allowedCalls: [LSP6AllowedCall!]! @derivedFrom(field: "controller")
  allowedCallsRawValue: String
  allowedDataKeys: [LSP6AllowedERC725YDataKey!]! @derivedFrom(field: "controller")
  allowedDataKeysRawValue: String
}

type LSP6Permission @entity {
  id: ID! @unique
  permissionName: String! @index
  permissionValue: Boolean! @index
  controller: LSP6Controller @index
}

type LSP6AllowedCall @entity {
  id: ID! @unique
  # 4 bytes
  restrictionOperations: String! @index
  # 20 bytes
  allowedAddress: String! @index
  # 4 bytes
  allowedInterfaceId: String! @index
  # 4 bytes
  allowedFunction: String! @index
  controller: LSP6Controller @index
}

type LSP6AllowedERC725YDataKey @entity {
  id: ID! @unique
  allowedDataKey: String! @index
  controller: LSP6Controller @index
}

type LSP8TokenIdFormat @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  digitalAsset: DigitalAsset! @index @unique
  value: LSP8TokenIdFormatEnum @index
  rawValue: String!
}

type LSP8ReferenceContract @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  digitalAsset: DigitalAsset! @index @unique
  value: String @index
  rawValue: String!
}

type LSP8TokenMetadataBaseURI @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  digitalAsset: DigitalAsset! @index @unique
  value: String @index
  rawValue: String!
}

type LSP12IssuedAssetsLength @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  universalProfile: UniversalProfile! @index @unique
  value: BigInt @index
  rawValue: String!
}

type LSP12IssuedAsset @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  universalProfile: UniversalProfile! @index
  assetAddress: String! @index
  issuedAsset: DigitalAsset @index
  arrayIndex: BigInt @index
  interfaceId: String @index
}

type LSP3Profile @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  universalProfile: UniversalProfile! @index
  name: LSP3ProfileName @derivedFrom(field: "lsp3Profile")
  description: LSP3ProfileDescription @derivedFrom(field: "lsp3Profile")
  tags: [LSP3ProfileTag!]! @derivedFrom(field: "lsp3Profile")
  links: [LSP3ProfileLink!]! @derivedFrom(field: "lsp3Profile")
  avatar: [LSP3ProfileAsset!]! @derivedFrom(field: "lsp3Profile")
  profileImage: [LSP3ProfileImage!]! @derivedFrom(field: "lsp3Profile")
  backgroundImage: [LSP3ProfileBackgroundImage!]! @derivedFrom(field: "lsp3Profile")
  url: String
  rawValue: String!
  decodeError: String
  isDataFetched: Boolean!
  fetchErrorMessage: String
  fetchErrorCode: String
  fetchErrorStatus: Int
  retryCount: Int
}

type LSP3ProfileName @entity {
  id: ID! @unique
  lsp3Profile: LSP3Profile! @index @unique
  value: String @index
}

type LSP3ProfileDescription @entity {
  id: ID! @unique
  lsp3Profile: LSP3Profile! @index @unique
  value: String
}
type LSP3ProfileTag @entity {
  id: ID! @unique
  lsp3Profile: LSP3Profile! @index
  value: String @index
}

type LSP3ProfileLink @entity {
  id: ID! @unique
  lsp3Profile: LSP3Profile! @index
  title: String @index
  url: String @index
}

type LSP3ProfileAsset @entity {
  id: ID! @unique
  lsp3Profile: LSP3Profile! @index
  url: String
  fileType: String @index
  verificationMethod: String
  verificationData: String
  verificationSource: String
}

type LSP3ProfileImage @entity {
  id: ID! @unique
  lsp3Profile: LSP3Profile! @index
  width: Int @index
  height: Int @index
  url: String
  verificationMethod: String
  verificationData: String
  verificationSource: String
}

type LSP3ProfileBackgroundImage @entity {
  id: ID! @unique
  lsp3Profile: LSP3Profile! @index
  url: String
  width: Int @index
  height: Int @index
  verificationMethod: String
  verificationData: String
  verificationSource: String
}

type LSP4Metadata @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  digitalAsset: DigitalAsset! @index
  tokenId: String @index
  nft: NFT @index
  name: LSP4MetadataName @derivedFrom(field: "lsp4Metadata")
  description: LSP4MetadataDescription @derivedFrom(field: "lsp4Metadata")
  score: LSP4MetadataScore @derivedFrom(field: "lsp4Metadata")
  rank: LSP4MetadataRank @derivedFrom(field: "lsp4Metadata")
  category: LSP4MetadataCategory @derivedFrom(field: "lsp4Metadata")
  links: [LSP4MetadataLink!]! @derivedFrom(field: "lsp4Metadata")
  icon: [LSP4MetadataIcon!]! @derivedFrom(field: "lsp4Metadata")
  images: [LSP4MetadataImage!]! @derivedFrom(field: "lsp4Metadata")
  assets: [LSP4MetadataAsset!]! @derivedFrom(field: "lsp4Metadata")
  attributes: [LSP4MetadataAttribute!]! @derivedFrom(field: "lsp4Metadata")
  url: String
  rawValue: String!
  decodeError: String
  isDataFetched: Boolean!
  fetchErrorMessage: String
  fetchErrorCode: String
  fetchErrorStatus: Int
  retryCount: Int
}

type LSP4MetadataName @entity {
  id: ID! @unique
  lsp4Metadata: LSP4Metadata! @index @unique
  value: String @index
}

type LSP4MetadataDescription @entity {
  id: ID! @unique
  lsp4Metadata: LSP4Metadata! @index @unique
  value: String
}

type LSP4MetadataScore @entity {
  id: ID! @unique
  lsp4Metadata: LSP4Metadata! @index @unique
  value: Int @index
}

type LSP4MetadataRank @entity {
  id: ID! @unique
  lsp4Metadata: LSP4Metadata! @index @unique
  value: Int @index
}

type LSP4MetadataCategory @entity {
  id: ID! @unique
  lsp4Metadata: LSP4Metadata! @index @unique
  value: String @index
}

type LSP4MetadataLink @entity {
  id: ID! @unique
  lsp4Metadata: LSP4Metadata! @index
  title: String @index
  url: String @index
}

type LSP4MetadataIcon @entity {
  id: ID! @unique
  lsp4Metadata: LSP4Metadata! @index
  url: String
  width: Int @index
  height: Int @index
  verificationMethod: String
  verificationData: String
  verificationSource: String
}

type LSP4MetadataImage @entity {
  id: ID! @unique
  lsp4Metadata: LSP4Metadata! @index
  url: String
  width: Int @index
  height: Int @index
  verificationMethod: String
  verificationData: String
  verificationSource: String
  imageIndex: Int! @index
}

type LSP4MetadataAsset @entity {
  id: ID! @unique
  lsp4Metadata: LSP4Metadata! @index
  url: String
  fileType: String @index
  verificationMethod: String
  verificationData: String
  verificationSource: String
}

type LSP4MetadataAttribute @entity {
  id: ID! @unique
  lsp4Metadata: LSP4Metadata! @index
  key: String @index
  value: String @index
  type: String @index
  score: Float @index
  rarity: Float @index
}

# LSP29 Encrypted Assets - Token-gated digital assets stored on Universal Profiles
type LSP29EncryptedAsset @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  universalProfile: UniversalProfile! @index

  # Content identification
  contentId: String @index
  revision: Int @index
  arrayIndex: BigInt @index

  # Parsed metadata fields
  version: String
  title: LSP29EncryptedAssetTitle @derivedFrom(field: "lsp29EncryptedAsset")
  description: LSP29EncryptedAssetDescription @derivedFrom(field: "lsp29EncryptedAsset")
  createdAt: DateTime @index

  # File metadata
  file: LSP29EncryptedAssetFile @derivedFrom(field: "lsp29EncryptedAsset")

  # Encryption metadata
  encryption: LSP29EncryptedAssetEncryption @derivedFrom(field: "lsp29EncryptedAsset")

  # Chunks info
  chunks: LSP29EncryptedAssetChunks @derivedFrom(field: "lsp29EncryptedAsset")

  # Social feed images
  images: [LSP29EncryptedAssetImage!]! @derivedFrom(field: "lsp29EncryptedAsset")

  # URL & fetch tracking (same pattern as LSP4)
  url: String
  rawValue: String!
  decodeError: String
  isDataFetched: Boolean!
  fetchErrorMessage: String
  fetchErrorCode: String
  fetchErrorStatus: Int
  retryCount: Int
}

type LSP29EncryptedAssetTitle @entity {
  id: ID! @unique
  lsp29EncryptedAsset: LSP29EncryptedAsset! @index @unique
  value: String @index
}

type LSP29EncryptedAssetDescription @entity {
  id: ID! @unique
  lsp29EncryptedAsset: LSP29EncryptedAsset! @index @unique
  value: String
}

type LSP29EncryptedAssetFile @entity {
  id: ID! @unique
  lsp29EncryptedAsset: LSP29EncryptedAsset! @index @unique
  type: String @index
  name: String @index
  size: BigInt
  lastModified: BigInt
  hash: String @index
}

type LSP29EncryptedAssetEncryption @entity {
  id: ID! @unique
  lsp29EncryptedAsset: LSP29EncryptedAsset! @index @unique
  method: String @index
  ciphertext: String
  dataToEncryptHash: String
  accessControlConditions: [LSP29AccessControlCondition!]! @derivedFrom(field: "encryption")
  decryptionCode: String
  decryptionParams: String
}

type LSP29AccessControlCondition @entity {
  id: ID! @unique
  encryption: LSP29EncryptedAssetEncryption! @index
  conditionIndex: Int! @index

  # Common fields for token-gating conditions
  contractAddress: String @index
  chain: String @index
  method: String @index

  # For balance-based conditions (LSP7/LSP8)
  standardContractType: String @index
  comparator: String @index
  value: String @index

  # For specific token ID conditions (LSP8)
  tokenId: String @index

  # For follower conditions (LSP26)
  followerAddress: String @index

  # Raw condition JSON for any condition type not parsed above
  rawCondition: String!
}

type LSP29EncryptedAssetChunks @entity {
  id: ID! @unique
  lsp29EncryptedAsset: LSP29EncryptedAsset! @index @unique
  cids: [String!]
  iv: String
  totalSize: BigInt
}

type LSP29EncryptedAssetImage @entity {
  id: ID! @unique
  lsp29EncryptedAsset: LSP29EncryptedAsset! @index
  url: String
  width: Int @index
  height: Int @index
  verificationMethod: String
  verificationData: String
  verificationSource: String
  imageIndex: Int! @index
}

type LSP29EncryptedAssetsLength @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  universalProfile: UniversalProfile! @index @unique
  value: BigInt @index
  rawValue: String!
}

type LSP29EncryptedAssetEntry @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  universalProfile: UniversalProfile! @index
  contentIdHash: String! @index
  arrayIndex: BigInt @index
}

type LSP29EncryptedAssetRevisionCount @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  address: String! @index
  universalProfile: UniversalProfile! @index
  contentIdHash: String! @index
  revisionCount: BigInt @index
  rawValue: String!
}

type ChillClaimed @entity {
  id: ID! @unique
  address: String! @index
  digitalAsset: DigitalAsset! @index
  tokenId: String! @index
  nft: NFT! @index @unique
  value: Boolean!
}

type OrbsClaimed @entity {
  id: ID! @unique
  address: String! @index
  digitalAsset: DigitalAsset! @index
  tokenId: String! @index
  nft: NFT! @index @unique
  value: Boolean!
}

type OrbLevel @entity {
  id: ID! @unique
  address: String! @index
  digitalAsset: DigitalAsset! @index
  tokenId: String! @index
  nft: NFT! @index @unique
  value: Int!
}

type OrbCooldownExpiry @entity {
  id: ID! @unique
  address: String! @index
  digitalAsset: DigitalAsset! @index
  tokenId: String! @index
  nft: NFT! @index @unique
  value: Int!
}

type OrbFaction @entity {
  id: ID! @unique
  address: String! @index
  digitalAsset: DigitalAsset! @index
  tokenId: String! @index
  nft: NFT! @index @unique
  value: String!
}

enum ListingStatus {
  ACTIVE
  PAUSED
  CLOSED
}

type Listing @entity {
  id: ID! @unique
  listingId: String! @index
  address: String! @index
  marketplaceProfile: String! @index
  seller: String! @index
  sellerUniversalProfile: UniversalProfile @index
  token: String! @index
  tokenDigitalAsset: DigitalAsset @index
  amount: BigInt! @index
  price: BigInt! @index
  status: ListingStatus! @index
  createdAt: DateTime! @index
  updatedAt: DateTime! @index
  closedAt: DateTime @index

  # Derived relations
  listingCreated: ListingCreated @derivedFrom(field: "listingEntity")
  listingClosed: ListingClosed @derivedFrom(field: "listingEntity")
  listingPaused: [ListingPaused!]! @derivedFrom(field: "listingEntity")
  listingUnpaused: [ListingUnpaused!]! @derivedFrom(field: "listingEntity")
  listingPriceUpdated: [ListingPriceUpdated!]! @derivedFrom(field: "listingEntity")
  tokensWithdrawn: [TokensWithdrawn!]! @derivedFrom(field: "listingEntity")
  purchaseCompleted: [PurchaseCompleted!]! @derivedFrom(field: "listingEntity")
}

type ListingCreated @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  marketplaceProfile: String! @index
  listingId: String! @index
  seller: String! @index
  sellerUniversalProfile: UniversalProfile @index
  token: String! @index
  tokenDigitalAsset: DigitalAsset @index
  amount: BigInt! @index
  price: BigInt! @index
  listingEntity: Listing! @unique
}

type ListingClosed @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  marketplaceProfile: String! @index
  listingId: String! @index
  listingEntity: Listing! @unique
}

type ListingPaused @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  marketplaceProfile: String! @index
  listingId: String! @index
  listingEntity: Listing! @index
}

type ListingUnpaused @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  marketplaceProfile: String! @index
  listingId: String! @index
  listingEntity: Listing! @index
}

type ListingPriceUpdated @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  marketplaceProfile: String! @index
  listingId: String! @index
  oldPriceUsd: BigInt! @index
  newPriceUsd: BigInt! @index
  listingEntity: Listing! @index
}

type TokensWithdrawn @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  marketplaceProfile: String! @index
  listingId: String! @index
  recipient: String! @index
  recipientUniversalProfile: UniversalProfile @index
  amount: BigInt! @index
  listingEntity: Listing! @index
}

type PurchaseCompleted @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  marketplaceProfile: String! @index
  listingId: String! @index
  buyer: String! @index
  buyerUniversalProfile: UniversalProfile @index
  seller: String! @index
  sellerUniversalProfile: UniversalProfile @index
  token: String! @index
  tokenDigitalAsset: DigitalAsset @index
  quantity: BigInt! @index
  price: BigInt! @index
  paymentToken: String! @index
  paymentTokenDigitalAsset: DigitalAsset @index
  totalPayment: BigInt! @index
  platformFee: BigInt! @index
  listingEntity: Listing! @index
}

type PlatformProceedsWithdrawn @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  marketplaceProfile: String! @index
  recipient: String! @index
  recipientUniversalProfile: UniversalProfile @index
  paymentToken: String! @index
  paymentTokenDigitalAsset: DigitalAsset @index
  amount: BigInt! @index
}

type SellerProceedsWithdrawn @entity {
  id: ID! @unique
  timestamp: DateTime! @index
  blockNumber: Int! @index
  logIndex: Int! @index
  transactionIndex: Int! @index
  address: String! @index
  marketplaceProfile: String! @index
  seller: String! @index
  sellerUniversalProfile: UniversalProfile @index
  recipient: String! @index
  recipientUniversalProfile: UniversalProfile @index
  paymentToken: String! @index
  paymentTokenDigitalAsset: DigitalAsset @index
  amount: BigInt! @index
}
